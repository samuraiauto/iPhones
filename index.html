<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iPhone Store ‚Äî –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω</title>
  <style>
    :root{
      --bg:#0b0f16;
      --card:#111827;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --accent:#22c55e;
      --danger:#ef4444;
      --border:rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(34,197,94,.18), transparent 60%),
                  radial-gradient(900px 500px at 110% 10%, rgba(59,130,246,.16), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{color:inherit}
    .container{max-width:1100px; margin:0 auto; padding:20px}
    header{
      position: sticky; top:0; z-index:10;
      backdrop-filter: blur(12px);
      background: rgba(11,15,22,.65);
      border-bottom: 1px solid var(--border);
    }
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:14px 20px;
      max-width:1100px; margin:0 auto;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px;
    }
    .logo{
      width:38px; height:38px; border-radius:12px;
      background: linear-gradient(135deg, rgba(34,197,94,.9), rgba(59,130,246,.9));
      box-shadow: var(--shadow);
    }
    .controls{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    }
    .input, select{
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      color: var(--text);
      padding:10px 12px;
      border-radius: 12px;
      outline: none;
      min-width: 220px;
    }
    select{min-width: 210px}
    .btn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      transition:.15s transform, .15s background;
      display:inline-flex; align-items:center; gap:8px;
      user-select:none;
    }
    .btn:hover{background: rgba(255,255,255,.09)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.35);
    }
    .badge{
      background: rgba(255,255,255,.10);
      border:1px solid var(--border);
      padding:2px 8px;
      border-radius:999px;
      font-size:12px;
      color: var(--text);
    }

    main{padding:22px 0 60px}
    .hero{
      padding: 22px 20px;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
    }
    .hero h1{margin:0 0 6px; font-size:26px}
    .hero p{margin:0; color:var(--muted)}
    .grid{
      margin-top:18px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .card{
      grid-column: span 4;
      background: rgba(255,255,255,.04);
      border:1px solid var(--border);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      display:flex; flex-direction:column;
    }
    .img{
      height:170px;
      background:
        radial-gradient(80% 80% at 30% 20%, rgba(255,255,255,.18), transparent 55%),
        linear-gradient(135deg, rgba(59,130,246,.25), rgba(34,197,94,.22)),
        rgba(255,255,255,.04);
      border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:center;
      padding:12px;
      position:relative;
      font-size:64px;
      transition:transform .2s;
    }
    .card:hover .img{
      transform:scale(1.05);
    }
    .card{
      transition:transform .2s, box-shadow .2s;
    }
    .card:hover{
      transform:translateY(-4px);
      box-shadow:0 12px 32px rgba(0,0,0,.35);
    }
    .tag{
      font-size:12px;
      padding:4px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border:1px solid var(--border);
      color: var(--text);
    }
    .content{padding:14px 14px 12px; display:flex; flex-direction:column; gap:10px; flex:1}
    .title{font-weight:800; font-size:16px; line-height:1.25}
    .muted{color:var(--muted); font-size:13px; line-height:1.35}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .price{font-weight:900; font-size:18px}
    .small{font-size:12px; color:var(--muted)}
    .actions{display:flex; gap:10px; margin-top:auto}
    .btn.icon{min-width:44px; justify-content:center}

    footer{
      border-top: 1px solid var(--border);
      color: var(--muted);
      padding: 18px 0 30px;
      font-size: 13px;
    }

    /* Modal */
    .overlay{
      position:fixed; inset:0; background: rgba(0,0,0,.55);
      display:none; align-items:center; justify-content:center;
      padding:20px;
    }
    .overlay.open{display:flex}
    .modal{
      width:min(760px, 100%);
      border-radius: 18px;
      border:1px solid var(--border);
      background: rgba(17,24,39,.95);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHead{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid var(--border);
    }
    .modalHead h2{margin:0; font-size:16px}
    .modalBody{padding:14px 16px}
    .cartList{display:flex; flex-direction:column; gap:10px; margin:0; padding:0; list-style:none}
    .cartItem{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
    }
    .cartLeft{display:flex; flex-direction:column; gap:2px}
    .qty{
      display:inline-flex; align-items:center; gap:8px;
    }
    .qty button{
      width:28px; height:28px; border-radius:10px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor:pointer;
    }
    .totalBox{
      margin-top:12px;
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 12px;
      border:1px solid rgba(34,197,94,.35);
      background: rgba(34,197,94,.10);
      border-radius: 14px;
    }
    .empty{
      color: var(--muted);
      text-align:center;
      padding:20px 0;
    }

    /* Product detail */
    .productDetail{
      display:grid; grid-template-columns: 1fr 1fr; gap:20px;
    }
    .productImage{
      height:400px; border-radius:16px;
      background: linear-gradient(135deg, rgba(59,130,246,.3), rgba(34,197,94,.25));
      display:flex; align-items:center; justify-content:center;
      font-size:120px; border:1px solid var(--border);
    }
    .productInfo h3{margin:0 0 12px; font-size:24px}
    .productSpecs{
      display:flex; flex-direction:column; gap:8px; margin:16px 0;
      padding:16px; background:rgba(255,255,255,.04); border-radius:12px; border:1px solid var(--border);
    }
    .specRow{
      display:flex; justify-content:space-between; padding:6px 0;
      border-bottom:1px solid var(--border);
    }
    .specRow:last-child{border-bottom:none}
    .colorOptions, .storageOptions{
      display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;
    }
    .colorOption, .storageOption{
      padding:8px 14px; border:1px solid var(--border);
      background:rgba(255,255,255,.04); border-radius:10px;
      cursor:pointer; transition:.15s;
    }
    .colorOption:hover, .storageOption:hover{
      background:rgba(255,255,255,.08);
      border-color:var(--accent);
    }
    .colorOption.selected, .storageOption.selected{
      background:rgba(34,197,94,.18);
      border-color:rgba(34,197,94,.35);
    }
    textarea.input{
      resize:vertical; font-family:inherit;
    }

    /* Responsive */
    @media (max-width: 980px){
      .card{grid-column: span 6;}
      .input{min-width: 180px}
      .productDetail{grid-template-columns: 1fr;}
    }
    @media (max-width: 640px){
      .card{grid-column: span 12;}
      .controls{justify-content:stretch}
      .input, select{min-width: 100%}
      .productImage{height:250px; font-size:80px;}
    }
  </style>
</head>
<body>

<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div>iPhone Store</div>
        <div class="small">–≤–∏—Ç—Ä–∏–Ω–∞ ‚Ä¢ –∫–æ—Ä–∑–∏–Ω–∞ ‚Ä¢ –¥–µ–º–æ</div>
      </div>
    </div>

    <div class="controls">
      <input id="q" class="input" placeholder="–ü–æ–∏—Å–∫: 13, 14 Pro, 15‚Ä¶" />
      <select id="priceFilter">
        <option value="all">–¶–µ–Ω–∞: –≤—Å–µ</option>
        <option value="0-600">–¶–µ–Ω–∞: –¥–æ 600‚Ç¨</option>
        <option value="600-800">–¶–µ–Ω–∞: 600-800‚Ç¨</option>
        <option value="800-1000">–¶–µ–Ω–∞: 800-1000‚Ç¨</option>
        <option value="1000+">–¶–µ–Ω–∞: –æ—Ç 1000‚Ç¨</option>
      </select>
      <select id="sort">
        <option value="popular">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
        <option value="priceAsc">–¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
        <option value="priceDesc">–¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
        <option value="nameAsc">–ù–∞–∑–≤–∞–Ω–∏–µ: A ‚Üí –Ø</option>
      </select>
      <button id="cartBtn" class="btn primary" type="button">
        üõí –ö–æ—Ä–∑–∏–Ω–∞ <span id="cartCount" class="badge">0</span>
      </button>
    </div>
  </div>
</header>

<div class="container">
  <main>
    <section class="hero">
      <h1>–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω iPhone</h1>
      <p>–î–æ–±–∞–≤–ª—è–π —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É, –º–µ–Ω—è–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∏—â–∏ –∏ —Å–æ—Ä—Ç–∏—Ä—É–π. –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (LocalStorage).</p>
      <div id="resultsCount" style="margin-top:12px; color:var(--muted); font-size:14px;"></div>
    </section>

    <section id="grid" class="grid" aria-live="polite"></section>
  </main>

  <footer>
    ¬© <span id="year"></span> iPhone Store. –î–µ–º–æ-–ø—Ä–æ–µ–∫—Ç. –û–ø–ª–∞—Ç–∞/–¥–æ—Å—Ç–∞–≤–∫–∞/–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å.
  </footer>
</div>

<!-- Product detail modal -->
<div id="productOverlay" class="overlay" role="dialog" aria-modal="true" aria-label="–î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞">
  <div class="modal" style="max-width:900px;">
    <div class="modalHead">
      <h2 id="productModalTitle">–î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞</h2>
      <button id="closeProduct" class="btn icon" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    </div>
    <div class="modalBody" id="productModalBody"></div>
  </div>
</div>

<!-- Cart modal -->
<div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">
  <div class="modal">
    <div class="modalHead">
      <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
      <button id="closeCart" class="btn icon" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    </div>
    <div class="modalBody">
      <ul id="cartList" class="cartList"></ul>
      <div id="empty" class="empty" style="display:none;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è. –î–æ–±–∞–≤—å iPhone –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ üôÇ</div>

      <div class="totalBox">
        <div>
          <div><strong>–ò—Ç–æ–≥–æ</strong></div>
          <div class="small">–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ</div>
        </div>
        <div>
          <div id="total" class="price">0 ‚Ç¨</div>
          <button id="checkout" class="btn primary" type="button">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
      </div>
      <div class="small" style="margin-top:10px; color:var(--muted);">
        * –ö–Ω–æ–ø–∫–∞ ¬´–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑¬ª –≤ –¥–µ–º–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Ç–æ–≥ –∏ –æ—á–∏—â–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É.
      </div>
    </div>
  </div>
</div>

<!-- Order form modal -->
<div id="orderOverlay" class="overlay" role="dialog" aria-modal="true" aria-label="–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞">
  <div class="modal" style="max-width:600px;">
    <div class="modalHead">
      <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
      <button id="closeOrder" class="btn icon" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    </div>
    <div class="modalBody">
      <form id="orderForm" style="display:flex; flex-direction:column; gap:14px;">
        <div>
          <label style="display:block; margin-bottom:6px; font-size:13px; color:var(--muted);">–ò–º—è *</label>
          <input type="text" name="name" required class="input" placeholder="–í–∞—à–µ –∏–º—è" />
        </div>
        <div>
          <label style="display:block; margin-bottom:6px; font-size:13px; color:var(--muted);">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
          <input type="tel" name="phone" required class="input" placeholder="+7 (999) 123-45-67" />
        </div>
        <div>
          <label style="display:block; margin-bottom:6px; font-size:13px; color:var(--muted);">Email *</label>
          <input type="email" name="email" required class="input" placeholder="email@example.com" />
        </div>
        <div>
          <label style="display:block; margin-bottom:6px; font-size:13px; color:var(--muted);">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *</label>
          <textarea name="address" required class="input" rows="3" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞"></textarea>
        </div>
        <div>
          <label style="display:block; margin-bottom:6px; font-size:13px; color:var(--muted);">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
          <textarea name="comment" class="input" rows="2" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
        </div>
        <div style="padding:12px; background:rgba(255,255,255,.04); border-radius:12px; border:1px solid var(--border);">
          <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
            <span>–¢–æ–≤–∞—Ä–æ–≤:</span>
            <strong id="orderItemsCount">0</strong>
          </div>
          <div style="display:flex; justify-content:space-between; font-size:18px;">
            <strong>–ö –æ–ø–ª–∞—Ç–µ:</strong>
            <strong class="price" id="orderTotal">0 ‚Ç¨</strong>
          </div>
        </div>
        <button type="submit" class="btn primary" style="width:100%; justify-content:center; margin-top:8px;">
          –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
        </button>
        <div class="small" style="text-align:center; color:var(--muted);">
          –≠—Ç–æ –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è. –†–µ–∞–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è.
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // ===== Demo catalog =====
  const products = [
    { 
      id:"iphone15", name:"iPhone 15", desc:"6.1‚Ä≥, Dynamic Island, USB-C", 
      price:799, tag:"–ù–æ–≤–∏–Ω–∫–∞", 
      storage:["128GB", "256GB", "512GB"], colors:["–ß—ë—Ä–Ω—ã–π", "–°–∏–Ω–∏–π", "–†–æ–∑–æ–≤—ã–π", "–ñ—ë–ª—Ç—ã–π"],
      screen:"6.1‚Ä≥ Super Retina XDR", chip:"A16 Bionic", camera:"48 –ú–ø –æ—Å–Ω–æ–≤–Ω–∞—è",
      battery:"–î–æ 20 —á–∞—Å–æ–≤ –≤–∏–¥–µ–æ", weight:"171 –≥", fullDesc:"iPhone 15 —Å Dynamic Island, USB-C –∏ —É–ª—É—á—à–µ–Ω–Ω–æ–π –∫–∞–º–µ—Ä–æ–π 48 –ú–ø. –ù–æ–≤—ã–π –¥–∏–∑–∞–π–Ω —Å –∑–∞–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–º–∏ –∫—Ä–∞—è–º–∏."
    },
    { 
      id:"iphone15p", name:"iPhone 15 Pro", desc:"–¢–∏—Ç–∞–Ω–æ–≤—ã–π –∫–æ—Ä–ø—É—Å, A17 Pro", 
      price:999, tag:"Pro",
      storage:["128GB", "256GB", "512GB", "1TB"], colors:["–¢–∏—Ç–∞–Ω", "–°–∏–Ω–∏–π —Ç–∏—Ç–∞–Ω", "–ë–µ–ª—ã–π —Ç–∏—Ç–∞–Ω", "–ß—ë—Ä–Ω—ã–π —Ç–∏—Ç–∞–Ω"],
      screen:"6.1‚Ä≥ Super Retina XDR ProMotion", chip:"A17 Pro", camera:"48 –ú–ø Pro —Å–∏—Å—Ç–µ–º–∞",
      battery:"–î–æ 23 —á–∞—Å–æ–≤ –≤–∏–¥–µ–æ", weight:"187 –≥", fullDesc:"iPhone 15 Pro —Å —Ç–∏—Ç–∞–Ω–æ–≤—ã–º –∫–æ—Ä–ø—É—Å–æ–º, —á–∏–ø–æ–º A17 Pro –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∫–∞–º–µ—Ä. Action Button –∏ USB-C."
    },
    { 
      id:"iphone15pm", name:"iPhone 15 Pro Max", desc:"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä, A17 Pro", 
      price:1199, tag:"Pro Max",
      storage:["256GB", "512GB", "1TB"], colors:["–¢–∏—Ç–∞–Ω", "–°–∏–Ω–∏–π —Ç–∏—Ç–∞–Ω", "–ë–µ–ª—ã–π —Ç–∏—Ç–∞–Ω", "–ß—ë—Ä–Ω—ã–π —Ç–∏—Ç–∞–Ω"],
      screen:"6.7‚Ä≥ Super Retina XDR ProMotion", chip:"A17 Pro", camera:"48 –ú–ø Pro —Å–∏—Å—Ç–µ–º–∞ —Å 5x –∑—É–º–æ–º",
      battery:"–î–æ 29 —á–∞—Å–æ–≤ –≤–∏–¥–µ–æ", weight:"221 –≥", fullDesc:"iPhone 15 Pro Max ‚Äî —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∏ –º–æ—â–Ω—ã–π iPhone —Å 5x —Ç–µ–ª–µ–æ–±—ä–µ–∫—Ç–∏–≤–æ–º –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é."
    },
    { 
      id:"iphone14", name:"iPhone 14", desc:"–û—Ç–ª–∏—á–Ω—ã–π –±–∞–ª–∞–Ω—Å —Ü–µ–Ω—ã/–∫–∞—á–µ—Å—Ç–≤–∞", 
      price:699, tag:"–•–∏—Ç",
      storage:["128GB", "256GB", "512GB"], colors:["–ß—ë—Ä–Ω—ã–π", "–°–∏–Ω–∏–π", "–§–∏–æ–ª–µ—Ç–æ–≤—ã–π", "–ö—Ä–∞—Å–Ω—ã–π", "–ë–µ–ª—ã–π"],
      screen:"6.1‚Ä≥ Super Retina XDR", chip:"A15 Bionic", camera:"12 –ú–ø –æ—Å–Ω–æ–≤–Ω–∞—è",
      battery:"–î–æ 20 —á–∞—Å–æ–≤ –≤–∏–¥–µ–æ", weight:"172 –≥", fullDesc:"iPhone 14 —Å —á–∏–ø–æ–º A15 Bionic, —É–ª—É—á—à–µ–Ω–Ω–æ–π –∫–∞–º–µ—Ä–æ–π –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–∞–¥–µ–Ω–∏–π. –û—Ç–ª–∏—á–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ –∫–∞—á–µ—Å—Ç–≤–∞."
    },
    { 
      id:"iphone14p", name:"iPhone 14 Pro", desc:"ProMotion, –∫–∞–º–µ—Ä–∞ Pro", 
      price:899, tag:"Pro",
      storage:["128GB", "256GB", "512GB", "1TB"], colors:["–¢—ë–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π", "–ó–æ–ª–æ—Ç–æ–π", "–°–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π", "–ì–ª—É–±–æ–∫–∏–π —á—ë—Ä–Ω—ã–π"],
      screen:"6.1‚Ä≥ Super Retina XDR ProMotion", chip:"A16 Bionic", camera:"48 –ú–ø Pro —Å–∏—Å—Ç–µ–º–∞",
      battery:"–î–æ 23 —á–∞—Å–æ–≤ –≤–∏–¥–µ–æ", weight:"206 –≥", fullDesc:"iPhone 14 Pro —Å Dynamic Island, —á–∏–ø–æ–º A16 Bionic –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∫–∞–º–µ—Ä —Å 48 –ú–ø —Å–µ–Ω—Å–æ—Ä–æ–º."
    },
    { 
      id:"iphone13", name:"iPhone 13", desc:"–ù–∞–¥—ë–∂–Ω–∞—è –∫–ª–∞—Å—Å–∏–∫–∞", 
      price:599, tag:"–í—ã–≥–æ–¥–Ω–æ",
      storage:["128GB", "256GB", "512GB"], colors:["–†–æ–∑–æ–≤—ã–π", "–°–∏–Ω–∏–π", "–ü–æ–ª–Ω–æ—á—å", "–ó–≤—ë–∑–¥–Ω—ã–π —Å–≤–µ—Ç", "–ö—Ä–∞—Å–Ω—ã–π"],
      screen:"6.1‚Ä≥ Super Retina XDR", chip:"A15 Bionic", camera:"12 –ú–ø –æ—Å–Ω–æ–≤–Ω–∞—è",
      battery:"–î–æ 19 —á–∞—Å–æ–≤ –≤–∏–¥–µ–æ", weight:"174 –≥", fullDesc:"iPhone 13 —Å —á–∏–ø–æ–º A15 Bionic, —É–ª—É—á—à–µ–Ω–Ω–æ–π –∫–∞–º–µ—Ä–æ–π –∏ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å—é. –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å."
    },
    { 
      id:"iphoneSE", name:"iPhone SE", desc:"–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π, –¥–æ—Å—Ç—É–ø–Ω—ã–π", 
      price:499, tag:"–ë—é–¥–∂–µ—Ç",
      storage:["64GB", "128GB", "256GB"], colors:["–ü–æ–ª–Ω–æ—á—å", "–ó–≤—ë–∑–¥–Ω—ã–π —Å–≤–µ—Ç", "–ö—Ä–∞—Å–Ω—ã–π"],
      screen:"4.7‚Ä≥ Retina HD", chip:"A15 Bionic", camera:"12 –ú–ø –æ—Å–Ω–æ–≤–Ω–∞—è",
      battery:"–î–æ 15 —á–∞—Å–æ–≤ –≤–∏–¥–µ–æ", weight:"144 –≥", fullDesc:"iPhone SE —Å —á–∏–ø–æ–º A15 Bionic –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –¥–∏–∑–∞–π–Ω–µ. –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä, –º–æ—â–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å."
    },
  ];

  // ===== State & storage =====
  const storageKey = "iphone_store_cart_v1";
  /** @type {Record<string, number>} */
  let cart = loadCart();

  function loadCart(){
    try{
      const raw = localStorage.getItem(storageKey);
      if(!raw) return {};
      const parsed = JSON.parse(raw);
      if(typeof parsed !== "object" || !parsed) return {};
      return parsed;
    }catch{ return {}; }
  }

  function saveCart(){
    localStorage.setItem(storageKey, JSON.stringify(cart));
  }

  // ===== Helpers =====
  const eur = new Intl.NumberFormat("ru-RU", { style:"currency", currency:"EUR", maximumFractionDigits:0 });

  function cartCount(){
    return Object.values(cart).reduce((a,b)=>a+b,0);
  }

  function cartTotal(){
    let sum = 0;
    for(const [id, qty] of Object.entries(cart)){
      const p = products.find(x => x.id === id);
      if(p) sum += p.price * qty;
    }
    return sum;
  }

  function addToCart(id){
    cart[id] = (cart[id] || 0) + 1;
    saveCart();
    renderCartBadge();
  }

  function changeQty(id, delta){
    const next = (cart[id] || 0) + delta;
    if(next <= 0) delete cart[id];
    else cart[id] = next;
    saveCart();
    renderCart();
    renderCartBadge();
  }

  // ===== Render catalog =====
  const grid = document.getElementById("grid");
  const qInput = document.getElementById("q");
  const sortSel = document.getElementById("sort");
  const priceFilterSel = document.getElementById("priceFilter");

  function getFilteredSorted(){
    const q = (qInput.value || "").trim().toLowerCase();
    let list = products.filter(p =>
      p.name.toLowerCase().includes(q) ||
      p.desc.toLowerCase().includes(q)
    );

    // Price filter
    const priceFilter = priceFilterSel.value;
    if(priceFilter !== "all"){
      const [min, max] = priceFilter.split("-").map(x => x === "" ? null : parseInt(x));
      list = list.filter(p => {
        if(priceFilter === "1000+") return p.price >= 1000;
        if(min === null) return p.price <= max;
        if(max === null) return p.price >= min;
        return p.price >= min && p.price <= max;
      });
    }

    switch(sortSel.value){
      case "priceAsc": list.sort((a,b)=>a.price-b.price); break;
      case "priceDesc": list.sort((a,b)=>b.price-a.price); break;
      case "nameAsc": list.sort((a,b)=>a.name.localeCompare(b.name, "ru")); break;
      default: /* popular */ break;
    }
    return list;
  }

  const resultsCountEl = document.getElementById("resultsCount");
  
  function renderCatalog(){
    const list = getFilteredSorted();
    const emojiMap = {
      "iphone15": "üì±",
      "iphone15p": "üì±‚ú®",
      "iphone15pm": "üì±üíé",
      "iphone14": "üì±",
      "iphone14p": "üì±‚≠ê",
      "iphone13": "üì±",
      "iphoneSE": "üì±"
    };
    
    // Update results count
    const count = list.length;
    const total = products.length;
    if(count === total){
      resultsCountEl.textContent = `–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${count}`;
    } else {
      resultsCountEl.textContent = `–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${count} –∏–∑ ${total}`;
    }
    
    grid.innerHTML = list.map(p => `
      <article class="card">
        <div class="img">
          <div style="font-size:64px; line-height:1;">${emojiMap[p.id] || "üì±"}</div>
          <span class="tag" style="position:absolute; top:12px; left:12px;">${escapeHtml(p.tag)}</span>
        </div>
        <div class="content">
          <div class="title">${escapeHtml(p.name)}</div>
          <div class="muted">${escapeHtml(p.desc)}</div>
          <div class="row">
            <div>
              <div class="price">${eur.format(p.price)}</div>
              <div class="small">–í –Ω–∞–ª–∏—á–∏–∏ ‚Ä¢ –î–æ—Å—Ç–∞–≤–∫–∞ 1‚Äì3 –¥–Ω—è</div>
            </div>
          </div>
          <div class="actions">
            <button class="btn primary" type="button" data-add="${p.id}">‚ûï –í –∫–æ—Ä–∑–∏–Ω—É</button>
            <button class="btn" type="button" data-buy="${p.id}">‚ö° –ö—É–ø–∏—Ç—å</button>
            <button class="btn" type="button" data-detail="${p.id}">‚ÑπÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          </div>
        </div>
      </article>
    `).join("");

    grid.querySelectorAll("[data-add]").forEach(btn=>{
      btn.addEventListener("click", ()=> addToCart(btn.dataset.add));
    });

    grid.querySelectorAll("[data-buy]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        addToCart(btn.dataset.buy);
        openCart();
      });
    });

    grid.querySelectorAll("[data-detail]").forEach(btn=>{
      btn.addEventListener("click", ()=> openProductDetail(btn.dataset.detail));
    });
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // ===== Cart modal =====
  const overlay = document.getElementById("overlay");
  const cartBtn = document.getElementById("cartBtn");
  const closeCartBtn = document.getElementById("closeCart");
  const cartList = document.getElementById("cartList");
  const empty = document.getElementById("empty");
  const totalEl = document.getElementById("total");
  const cartCountEl = document.getElementById("cartCount");
  const checkoutBtn = document.getElementById("checkout");

  function openCart(){
    overlay.classList.add("open");
    renderCart();
  }
  function closeCart(){
    overlay.classList.remove("open");
  }

  function renderCartBadge(){
    cartCountEl.textContent = String(cartCount());
  }

  function renderCart(){
    const entries = Object.entries(cart);
    if(entries.length === 0){
      cartList.innerHTML = "";
      empty.style.display = "block";
    }else{
      empty.style.display = "none";
      cartList.innerHTML = entries.map(([id, qty])=>{
        const p = products.find(x => x.id === id);
        if(!p) return "";
        return `
          <li class="cartItem">
            <div class="cartLeft">
              <div><strong>${escapeHtml(p.name)}</strong></div>
              <div class="small">${escapeHtml(p.desc)}</div>
              <div class="small">${eur.format(p.price)} –∑–∞ —à—Ç.</div>
            </div>
            <div class="qty">
              <button type="button" data-dec="${id}" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å">‚àí</button>
              <div><strong>${qty}</strong></div>
              <button type="button" data-inc="${id}" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
            </div>
            <div style="min-width:120px; text-align:right;">
              <div class="price">${eur.format(p.price * qty)}</div>
              <button class="btn" type="button" data-remove="${id}" style="margin-top:6px; border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.10);">
                üóë –£–¥–∞–ª–∏—Ç—å
              </button>
            </div>
          </li>
        `;
      }).join("");

      cartList.querySelectorAll("[data-inc]").forEach(b=> b.addEventListener("click", ()=> changeQty(b.dataset.inc, +1)));
      cartList.querySelectorAll("[data-dec]").forEach(b=> b.addEventListener("click", ()=> changeQty(b.dataset.dec, -1)));
      cartList.querySelectorAll("[data-remove]").forEach(b=> b.addEventListener("click", ()=>{
        delete cart[b.dataset.remove];
        saveCart();
        renderCart();
        renderCartBadge();
      }));
    }
    totalEl.textContent = eur.format(cartTotal());
  }

  // ===== Product detail modal =====
  const productOverlay = document.getElementById("productOverlay");
  const productModalTitle = document.getElementById("productModalTitle");
  const productModalBody = document.getElementById("productModalBody");
  const closeProductBtn = document.getElementById("closeProduct");
  let selectedStorage = {};
  let selectedColor = {};

  function openProductDetail(id){
    const p = products.find(x => x.id === id);
    if(!p) return;
    
    selectedStorage[id] = p.storage?.[0] || "";
    selectedColor[id] = p.colors?.[0] || "";
    
    productModalTitle.textContent = p.name;
    productModalBody.innerHTML = `
      <div class="productDetail">
        <div>
          <div class="productImage">üì±</div>
        </div>
        <div class="productInfo">
          <h3>${escapeHtml(p.name)}</h3>
          <div class="price" style="font-size:28px; margin-bottom:16px;">${eur.format(p.price)}</div>
          <div class="muted" style="margin-bottom:16px;">${escapeHtml(p.fullDesc || p.desc)}</div>
          
          ${p.storage ? `
            <div style="margin-bottom:12px;">
              <div style="margin-bottom:6px; font-size:13px; color:var(--muted);">–û–±—ä—ë–º –ø–∞–º—è—Ç–∏:</div>
              <div class="storageOptions">
                ${p.storage.map(s => `
                  <button type="button" class="storageOption ${selectedStorage[id] === s ? 'selected' : ''}" 
                    data-storage="${s}" data-id="${id}">${s}</button>
                `).join("")}
              </div>
            </div>
          ` : ""}
          
          ${p.colors ? `
            <div style="margin-bottom:12px;">
              <div style="margin-bottom:6px; font-size:13px; color:var(--muted);">–¶–≤–µ—Ç:</div>
              <div class="colorOptions">
                ${p.colors.map(c => `
                  <button type="button" class="colorOption ${selectedColor[id] === c ? 'selected' : ''}" 
                    data-color="${c}" data-id="${id}">${c}</button>
                `).join("")}
              </div>
            </div>
          ` : ""}
          
          <div class="productSpecs">
            <div class="specRow">
              <span class="muted">–≠–∫—Ä–∞–Ω:</span>
              <strong>${escapeHtml(p.screen || "‚Äî")}</strong>
            </div>
            <div class="specRow">
              <span class="muted">–ß–∏–ø:</span>
              <strong>${escapeHtml(p.chip || "‚Äî")}</strong>
            </div>
            <div class="specRow">
              <span class="muted">–ö–∞–º–µ—Ä–∞:</span>
              <strong>${escapeHtml(p.camera || "‚Äî")}</strong>
            </div>
            <div class="specRow">
              <span class="muted">–ë–∞—Ç–∞—Ä–µ—è:</span>
              <strong>${escapeHtml(p.battery || "‚Äî")}</strong>
            </div>
            <div class="specRow">
              <span class="muted">–í–µ—Å:</span>
              <strong>${escapeHtml(p.weight || "‚Äî")}</strong>
            </div>
          </div>
          
          <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn primary" type="button" data-add-detail="${id}" style="flex:1;">
              ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
            </button>
            <button class="btn" type="button" data-buy-detail="${id}" style="flex:1;">
              ‚ö° –ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å
            </button>
          </div>
        </div>
      </div>
    `;
    
    // Storage selection
    productModalBody.querySelectorAll(".storageOption").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.dataset.id;
        productModalBody.querySelectorAll(`.storageOption[data-id="${id}"]`).forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedStorage[id] = btn.dataset.storage;
      });
    });
    
    // Color selection
    productModalBody.querySelectorAll(".colorOption").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.dataset.id;
        productModalBody.querySelectorAll(`.colorOption[data-id="${id}"]`).forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedColor[id] = btn.dataset.color;
      });
    });
    
    // Add to cart from detail
    productModalBody.querySelectorAll("[data-add-detail]").forEach(btn => {
      btn.addEventListener("click", () => {
        addToCart(btn.dataset.addDetail);
        alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É: ${p.name} (${selectedStorage[p.id] || ""} ${selectedColor[p.id] || ""})`);
      });
    });
    
    // Buy from detail
    productModalBody.querySelectorAll("[data-buy-detail]").forEach(btn => {
      btn.addEventListener("click", () => {
        addToCart(btn.dataset.buyDetail);
        closeProductDetail();
        openCart();
      });
    });
    
    productOverlay.classList.add("open");
  }
  
  function closeProductDetail(){
    productOverlay.classList.remove("open");
  }

  // ===== Order form =====
  const orderOverlay = document.getElementById("orderOverlay");
  const orderForm = document.getElementById("orderForm");
  const closeOrderBtn = document.getElementById("closeOrder");
  const orderItemsCount = document.getElementById("orderItemsCount");
  const orderTotal = document.getElementById("orderTotal");

  function openOrderForm(){
    const count = cartCount();
    const total = cartTotal();
    if(count === 0){
      alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è üôÇ");
      return;
    }
    orderItemsCount.textContent = String(count);
    orderTotal.textContent = eur.format(total);
    orderOverlay.classList.add("open");
  }

  function closeOrderForm(){
    orderOverlay.classList.remove("open");
  }

  // ===== Events =====
  cartBtn.addEventListener("click", openCart);
  closeCartBtn.addEventListener("click", closeCart);
  overlay.addEventListener("click", (e)=>{
    if(e.target === overlay) closeCart();
  });
  
  closeProductBtn.addEventListener("click", closeProductDetail);
  productOverlay.addEventListener("click", (e)=>{
    if(e.target === productOverlay) closeProductDetail();
  });
  
  closeOrderBtn.addEventListener("click", closeOrderForm);
  orderOverlay.addEventListener("click", (e)=>{
    if(e.target === orderOverlay) closeOrderForm();
  });
  
  window.addEventListener("keydown", (e)=>{
    if(e.key === "Escape"){
      closeCart();
      closeProductDetail();
      closeOrderForm();
    }
  });

  qInput.addEventListener("input", renderCatalog);
  sortSel.addEventListener("change", renderCatalog);
  priceFilterSel.addEventListener("change", renderCatalog);

  checkoutBtn.addEventListener("click", ()=>{
    closeCart();
    openOrderForm();
  });

  orderForm.addEventListener("submit", (e)=>{
    e.preventDefault();
    const formData = new FormData(orderForm);
    const data = Object.fromEntries(formData);
    const total = cartTotal();
    
    console.log("Order data:", data);
    console.log("Total:", total);
    
    alert(`–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! (–¥–µ–º–æ)\n\n–ò–º—è: ${data.name}\n–¢–µ–ª–µ—Ñ–æ–Ω: ${data.phone}\nEmail: ${data.email}\n–ê–¥—Ä–µ—Å: ${data.address}\n\n–°—É–º–º–∞: ${eur.format(total)}\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!`);
    
    cart = {};
    saveCart();
    renderCart();
    renderCartBadge();
    closeOrderForm();
    orderForm.reset();
  });

  document.getElementById("year").textContent = new Date().getFullYear();

  // Initial render
  renderCatalog();
  renderCartBadge();
</script>

</body>
</html>
